<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Data transformation | COVID, Kobe, and Injury in the NBA</title>
  <meta name="description" content="Chapter 3 Data transformation | COVID, Kobe, and Injury in the NBA" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Data transformation | COVID, Kobe, and Injury in the NBA" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Data transformation | COVID, Kobe, and Injury in the NBA" />
  
  
  

<meta name="author" content="Santos Hernandez and Rahul Subramaniam" />


<meta name="date" content="2021-04-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-sources.html"/>
<link rel="next" href="missing-values.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">NBA - EDAV</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#why-basketball"><i class="fa fa-check"></i><b>1.1</b> Why basketball?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-sources.html"><a href="data-sources.html"><i class="fa fa-check"></i><b>2</b> Data sources</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-sources.html"><a href="data-sources.html#game-statistics"><i class="fa fa-check"></i><b>2.1</b> Game statistics</a></li>
<li class="chapter" data-level="2.2" data-path="data-sources.html"><a href="data-sources.html#covid-cases"><i class="fa fa-check"></i><b>2.2</b> COVID cases</a></li>
<li class="chapter" data-level="2.3" data-path="data-sources.html"><a href="data-sources.html#kobe-bryants-connections"><i class="fa fa-check"></i><b>2.3</b> Kobe Bryant’s Connections</a></li>
<li class="chapter" data-level="2.4" data-path="data-sources.html"><a href="data-sources.html#player-positions-and-injuries"><i class="fa fa-check"></i><b>2.4</b> Player positions and injuries</a></li>
<li class="chapter" data-level="2.5" data-path="data-sources.html"><a href="data-sources.html#issues"><i class="fa fa-check"></i><b>2.5</b> Issues</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-transformation.html"><a href="data-transformation.html"><i class="fa fa-check"></i><b>3</b> Data transformation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-transformation.html"><a href="data-transformation.html#game-statistics-1"><i class="fa fa-check"></i><b>3.1</b> Game statistics</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="data-transformation.html"><a href="data-transformation.html#covid-cases-1"><i class="fa fa-check"></i><b>3.1.1</b> COVID cases</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-transformation.html"><a href="data-transformation.html#kobe-bryant-demise-effect"><i class="fa fa-check"></i><b>3.2</b> Kobe Bryant Demise Effect</a></li>
<li class="chapter" data-level="3.3" data-path="data-transformation.html"><a href="data-transformation.html#injury-and-player-positions"><i class="fa fa-check"></i><b>3.3</b> Injury and player positions</a></li>
<li class="chapter" data-level="3.4" data-path="data-transformation.html"><a href="data-transformation.html#d3"><i class="fa fa-check"></i><b>3.4</b> d3</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="missing-values.html"><a href="missing-values.html"><i class="fa fa-check"></i><b>4</b> Missing values</a>
<ul>
<li class="chapter" data-level="4.1" data-path="missing-values.html"><a href="missing-values.html#game-statistics-2"><i class="fa fa-check"></i><b>4.1</b> Game statistics</a></li>
<li class="chapter" data-level="4.2" data-path="missing-values.html"><a href="missing-values.html#injury-and-position"><i class="fa fa-check"></i><b>4.2</b> Injury and position</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>5</b> Results</a>
<ul>
<li class="chapter" data-level="5.1" data-path="results.html"><a href="results.html#covid"><i class="fa fa-check"></i><b>5.1</b> COVID</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="results.html"><a href="results.html#approach"><i class="fa fa-check"></i><b>5.1.1</b> Approach</a></li>
<li class="chapter" data-level="5.1.2" data-path="results.html"><a href="results.html#offense"><i class="fa fa-check"></i><b>5.1.2</b> Offense</a></li>
<li class="chapter" data-level="5.1.3" data-path="results.html"><a href="results.html#defense"><i class="fa fa-check"></i><b>5.1.3</b> Defense</a></li>
<li class="chapter" data-level="5.1.4" data-path="results.html"><a href="results.html#overall"><i class="fa fa-check"></i><b>5.1.4</b> Overall</a></li>
<li class="chapter" data-level="5.1.5" data-path="results.html"><a href="results.html#players"><i class="fa fa-check"></i><b>5.1.5</b> Players</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="results.html"><a href="results.html#kobe-bryant-demise-effect-1"><i class="fa fa-check"></i><b>5.2</b> Kobe Bryant Demise Effect</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="results.html"><a href="results.html#approach-1"><i class="fa fa-check"></i><b>5.2.1</b> Approach</a></li>
<li class="chapter" data-level="5.2.2" data-path="results.html"><a href="results.html#team-performance-analysis"><i class="fa fa-check"></i><b>5.2.2</b> Team Performance Analysis</a></li>
<li class="chapter" data-level="5.2.3" data-path="results.html"><a href="results.html#selected-teams"><i class="fa fa-check"></i><b>5.2.3</b> Selected Teams</a></li>
<li class="chapter" data-level="5.2.4" data-path="results.html"><a href="results.html#player-performance"><i class="fa fa-check"></i><b>5.2.4</b> Player Performance</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="results.html"><a href="results.html#injuries-and-positions"><i class="fa fa-check"></i><b>5.3</b> Injuries And Positions</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="results.html"><a href="results.html#approach-2"><i class="fa fa-check"></i><b>5.3.1</b> Approach</a></li>
<li class="chapter" data-level="5.3.2" data-path="results.html"><a href="results.html#injured-parts-vs-player-position"><i class="fa fa-check"></i><b>5.3.2</b> Injured parts vs player position</a></li>
<li class="chapter" data-level="5.3.3" data-path="results.html"><a href="results.html#injuries-over-the-years"><i class="fa fa-check"></i><b>5.3.3</b> Injuries over the years</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="interactive-component.html"><a href="interactive-component.html"><i class="fa fa-check"></i><b>6</b> Interactive component</a></li>
<li class="chapter" data-level="7" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>7</b> Conclusion</a>
<ul>
<li class="chapter" data-level="7.1" data-path="conclusion.html"><a href="conclusion.html#covid-1"><i class="fa fa-check"></i><b>7.1</b> COVID</a></li>
<li class="chapter" data-level="7.2" data-path="conclusion.html"><a href="conclusion.html#kobe-bryant-demise-effect-2"><i class="fa fa-check"></i><b>7.2</b> Kobe Bryant Demise Effect</a></li>
<li class="chapter" data-level="7.3" data-path="conclusion.html"><a href="conclusion.html#injury-and-positions"><i class="fa fa-check"></i><b>7.3</b> Injury and Positions</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">COVID, Kobe, and Injury in the NBA</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-transformation" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Data transformation</h1>
<div id="game-statistics-1" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Game statistics</h2>
<div id="covid-cases-1" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> COVID cases</h3>
<p>When using the NBA stats R package, requested data comes as a nested dataframe.
Each row has data for a single season, with either regular season or playoff data.
So if you requested 2018-19 and 2019-2020 data for the regular season and playoffs,
4 rows would be returned. A column at the end has the actual game stats dataframes,
so these must be unnested.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="data-transformation.html#cb1-1" aria-hidden="true" tabindex="-1"></a>covid_season_month_before <span class="ot">&lt;-</span> <span class="fu">teams_players_stats</span>(<span class="at">seasons =</span> <span class="dv">2020</span>, <span class="at">measures =</span> <span class="st">&quot;Advanced&quot;</span>, <span class="at">types =</span> <span class="st">&quot;team&quot;</span>, <span class="at">tables =</span> <span class="st">&quot;general&quot;</span>, <span class="at">modes =</span> <span class="st">&quot;PerGame&quot;</span>, <span class="at">date_from =</span> <span class="st">&quot;2-11-20&quot;</span>, <span class="at">date_to =</span> <span class="st">&quot;3-11-20&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-2"><a href="data-transformation.html#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(dataTable) <span class="sc">%&gt;%</span> </span>
<span id="cb1-3"><a href="data-transformation.html#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">df_type =</span> <span class="st">&quot;month_before&quot;</span>)</span>
<span id="cb1-4"><a href="data-transformation.html#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="data-transformation.html#cb1-5" aria-hidden="true" tabindex="-1"></a>bubble <span class="ot">&lt;-</span> <span class="fu">teams_players_stats</span>(<span class="at">seasons =</span> <span class="dv">2020</span>, <span class="at">measures =</span> <span class="st">&quot;Advanced&quot;</span>,  <span class="at">types =</span> <span class="st">&quot;team&quot;</span>, <span class="at">season_types =</span> <span class="fu">c</span>(<span class="st">&quot;Regular Season&quot;</span>, <span class="st">&quot;Playoffs&quot;</span>), <span class="at">tables =</span> <span class="st">&quot;general&quot;</span>, <span class="at">modes =</span> <span class="st">&quot;PerGame&quot;</span>, <span class="at">date_from =</span> <span class="st">&quot;7-29-20&quot;</span>, <span class="at">date_to =</span> <span class="st">&quot;10-11-20&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-6"><a href="data-transformation.html#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(dataTable) </span></code></pre></div>
<p>We split the time periods that we wanted to compare into separate dataframes and added a new column,
<code>df_type</code>, to distinguish them.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="data-transformation.html#cb2-1" aria-hidden="true" tabindex="-1"></a>bubble_seeding <span class="ot">&lt;-</span> bubble <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="data-transformation.html#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(typeSeason <span class="sc">==</span> <span class="st">&quot;Regular Season&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="data-transformation.html#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">df_type =</span> <span class="st">&quot;bubble_seeding&quot;</span>) </span>
<span id="cb2-4"><a href="data-transformation.html#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="data-transformation.html#cb2-5" aria-hidden="true" tabindex="-1"></a>bubble_playoffs <span class="ot">&lt;-</span> bubble <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="data-transformation.html#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(typeSeason <span class="sc">==</span> <span class="st">&quot;Playoffs&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-7"><a href="data-transformation.html#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">df_type =</span> <span class="st">&quot;bubble_playoffs&quot;</span>)   </span></code></pre></div>
<p>Finally, we made the data long for it to work with ggplot. The data when requested comes wide,
with a column for each statistic.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="data-transformation.html#cb3-1" aria-hidden="true" tabindex="-1"></a>bubble_stats_long <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(covid_season_month_before,</span>
<span id="cb3-2"><a href="data-transformation.html#cb3-2" aria-hidden="true" tabindex="-1"></a>                               bubble_seeding,</span>
<span id="cb3-3"><a href="data-transformation.html#cb3-3" aria-hidden="true" tabindex="-1"></a>                               bubble_playoffs,) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="data-transformation.html#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(nameTeam<span class="sc">:</span>paceE,</span>
<span id="cb3-5"><a href="data-transformation.html#cb3-5" aria-hidden="true" tabindex="-1"></a>         df_type,</span>
<span id="cb3-6"><a href="data-transformation.html#cb3-6" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="fu">contains</span>(<span class="st">&quot;rank&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co">#drop some stats we&#39;re not interested in</span></span>
<span id="cb3-7"><a href="data-transformation.html#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(gp<span class="sc">:</span>paceE, <span class="at">names_to =</span> <span class="st">&quot;rating&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="data-transformation.html#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(bubble_teams, <span class="at">by =</span> <span class="st">&quot;nameTeam&quot;</span>) <span class="co">#only teams that were invited to bubble</span></span></code></pre></div>
<p>The same process was used for both team and player data because they come in the same form.</p>
<p>Some additional steps were taken to integrate the COVID case data. The table from SLAM was
crawled with <code>rvest</code> and cleaned slightly to be able to join onto the player stats. Furthermore,
the dates were converted into date objects so that they would display in order on the x-axis.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="data-transformation.html#cb4-1" aria-hidden="true" tabindex="-1"></a>covid_players <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">&quot;https://www.slamonline.com/nba/nba-coronavirus-covid-list/&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="data-transformation.html#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="at">css =</span> <span class="st">&quot;.wp-block-table&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="data-transformation.html#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>(<span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-4"><a href="data-transformation.html#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="data-transformation.html#cb4-5" aria-hidden="true" tabindex="-1"></a>covid_players_fixed <span class="ot">&lt;-</span> covid_players <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href="data-transformation.html#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">name =</span> <span class="st">&quot;Player&quot;</span>,</span>
<span id="cb4-7"><a href="data-transformation.html#cb4-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">date_reported =</span> <span class="st">&quot;Reported&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-8"><a href="data-transformation.html#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">team_abb =</span> <span class="fu">str_sub</span>(name, <span class="sc">-</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">2</span>),</span>
<span id="cb4-9"><a href="data-transformation.html#cb4-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="fu">str_remove</span>(name, <span class="st">&quot; </span><span class="sc">\\</span><span class="st">(.+</span><span class="sc">\\</span><span class="st">)&quot;</span>),</span>
<span id="cb4-10"><a href="data-transformation.html#cb4-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">date_reported =</span> <span class="fu">str_remove</span>(date_reported, <span class="st">&quot; </span><span class="sc">\\</span><span class="st">(.+</span><span class="sc">\\</span><span class="st">)&quot;</span>),</span>
<span id="cb4-11"><a href="data-transformation.html#cb4-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">date_reported =</span> <span class="fu">mdy</span>(<span class="fu">str_c</span>(date_reported, <span class="st">&quot; 2020&quot;</span>)))</span></code></pre></div>
</div>
</div>
<div id="kobe-bryant-demise-effect" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Kobe Bryant Demise Effect</h2>
<p>Similar to the format in the COVID cases problem, the data for every NBA team comes as a nested dataframe. However, this time the time frame of the data to be analyzed is much lesser (data ranges from 3 weeks before and 2 weeks after Kobe’s death). Hence, we cannot request the data for all seasons in one go, and must selectively obtain the data for each season.</p>
<p>We obtained the data for every season in two separate dataframes:</p>
<ol style="list-style-type: decimal">
<li>The data for every team before Kobe’s demise ( range from 5th January to 25th of January)</li>
<li>The data for every team after Kobe’s demise (range from 26th January to 9th of February)</li>
</ol>
<p>For the sake of analysis and visualization, we had to divide the 30 NBA teams into top 15 and bottom 15 (based on the net rating score for every team in the 2020 season).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="data-transformation.html#cb5-1" aria-hidden="true" tabindex="-1"></a>team_data_2020_after_26 <span class="ot">&lt;-</span> <span class="fu">teams_players_stats</span>(<span class="at">seasons =</span> <span class="dv">2020</span>, <span class="at">measures =</span> <span class="st">&quot;Advanced&quot;</span>, <span class="at">types =</span> <span class="st">&quot;team&quot;</span>, <span class="at">tables =</span> <span class="st">&quot;general&quot;</span>, <span class="at">modes =</span> <span class="st">&quot;PerGame&quot;</span>, <span class="at">date_from =</span> <span class="st">&quot;1-26-20&quot;</span>, <span class="at">date_to =</span> <span class="st">&quot;2-9-20&quot;</span>)<span class="sc">$</span>dataTable[[<span class="dv">1</span>]]</span>
<span id="cb5-2"><a href="data-transformation.html#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="data-transformation.html#cb5-3" aria-hidden="true" tabindex="-1"></a>team_data_2020_before_26 <span class="ot">&lt;-</span> <span class="fu">teams_players_stats</span>(<span class="at">seasons =</span> <span class="dv">2020</span>, <span class="at">measures =</span> <span class="st">&quot;Advanced&quot;</span>, <span class="at">types =</span> <span class="st">&quot;team&quot;</span>, <span class="at">tables =</span> <span class="st">&quot;general&quot;</span>, <span class="at">modes =</span> <span class="st">&quot;PerGame&quot;</span>, <span class="at">date_from =</span> <span class="st">&quot;1-5-20&quot;</span>, <span class="at">date_to =</span> <span class="st">&quot;1-25-20&quot;</span>)<span class="sc">$</span>dataTable[[<span class="dv">1</span>]]</span>
<span id="cb5-4"><a href="data-transformation.html#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="data-transformation.html#cb5-5" aria-hidden="true" tabindex="-1"></a>ordered_team_data_2020_after_death <span class="ot">&lt;-</span>team_data_2020_after_26[<span class="fu">order</span>(team_data_2020_after_26[,<span class="dv">41</span>]),]</span>
<span id="cb5-6"><a href="data-transformation.html#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="data-transformation.html#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="data-transformation.html#cb5-8" aria-hidden="true" tabindex="-1"></a>team_list <span class="ot">&lt;-</span> ordered_team_data_2020_after_death<span class="sc">$</span>nameTeam</span>
<span id="cb5-9"><a href="data-transformation.html#cb5-9" aria-hidden="true" tabindex="-1"></a>bottom_teams <span class="ot">&lt;-</span> team_list[<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>]</span>
<span id="cb5-10"><a href="data-transformation.html#cb5-10" aria-hidden="true" tabindex="-1"></a>top_teams <span class="ot">&lt;-</span> team_list[<span class="dv">16</span><span class="sc">:</span><span class="dv">30</span>]</span></code></pre></div>
<p>This was followed by a series of subsetting and pivoting operations so that we could get the net rating of teams within the pre-Kobe as well as the post-Kobe timeframe. We pivotted longer on the net rating variable.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data-transformation.html#cb6-1" aria-hidden="true" tabindex="-1"></a>team_data_2020_after_26_top_teams <span class="ot">&lt;-</span> <span class="fu">subset</span>(team_data_2020_after_26,nameTeam <span class="sc">%in%</span> top_teams)</span>
<span id="cb6-2"><a href="data-transformation.html#cb6-2" aria-hidden="true" tabindex="-1"></a>netrating_after_26<span class="ot">&lt;-</span> team_data_2020_after_26_top_teams<span class="sc">$</span>netrtg</span>
<span id="cb6-3"><a href="data-transformation.html#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="data-transformation.html#cb6-4" aria-hidden="true" tabindex="-1"></a>teams <span class="ot">&lt;-</span> team_data_2020_after_26_top_teams<span class="sc">$</span>nameTeam</span>
<span id="cb6-5"><a href="data-transformation.html#cb6-5" aria-hidden="true" tabindex="-1"></a>bar_plot_df_2020_top_teams <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(teams,netrating_before_26,netrating_after_26)</span>
<span id="cb6-6"><a href="data-transformation.html#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="data-transformation.html#cb6-7" aria-hidden="true" tabindex="-1"></a>pivoted_bar_plot_df_2020_top_teams <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(bar_plot_df_2020_top_teams,<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&#39;netrating_before_26&#39;</span>,<span class="st">&#39;netrating_after_26&#39;</span>),<span class="at">names_to=</span><span class="st">&#39;variable&#39;</span>, </span>
<span id="cb6-8"><a href="data-transformation.html#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="at">values_to=</span><span class="st">&quot;value&quot;</span>)</span>
<span id="cb6-9"><a href="data-transformation.html#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="data-transformation.html#cb6-10" aria-hidden="true" tabindex="-1"></a>netrating_after_26<span class="ot">&lt;-</span> team_data_2020_after_26_bottom_teams<span class="sc">$</span>netrtg</span>
<span id="cb6-11"><a href="data-transformation.html#cb6-11" aria-hidden="true" tabindex="-1"></a>pivoted_bar_plot_df_2020_top_teams</span></code></pre></div>
<p>A similar approach was taken to obtain team statistics for years before and after Kobe’s death. We retrieved the team performance statistics for previous years till 2017 season, and subsetted only those teams in our selected teams list.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="data-transformation.html#cb7-1" aria-hidden="true" tabindex="-1"></a>selected_teams_years_analysis <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;Los Angeles Lakers&#39;</span>,<span class="st">&#39;LA Clippers&#39;</span>,<span class="st">&#39;Dallas Mavericks&#39;</span>,<span class="st">&#39;Philadelphia 76ers&#39;</span>,<span class="st">&#39;Utah Jazz&#39;</span>)</span>
<span id="cb7-2"><a href="data-transformation.html#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="data-transformation.html#cb7-3" aria-hidden="true" tabindex="-1"></a>team_data_2018_after_26 <span class="ot">&lt;-</span> <span class="fu">teams_players_stats</span>(<span class="at">seasons =</span> <span class="dv">2018</span>, <span class="at">measures =</span> <span class="st">&quot;Advanced&quot;</span>, <span class="at">types =</span> <span class="st">&quot;team&quot;</span>, <span class="at">tables =</span> <span class="st">&quot;general&quot;</span>, <span class="at">modes =</span> <span class="st">&quot;PerGame&quot;</span>, <span class="at">date_from =</span> <span class="st">&quot;1-26-18&quot;</span>, <span class="at">date_to =</span> <span class="st">&quot;2-9-18&quot;</span>)<span class="sc">$</span>dataTable[[<span class="dv">1</span>]]</span>
<span id="cb7-4"><a href="data-transformation.html#cb7-4" aria-hidden="true" tabindex="-1"></a>selected_team_data_2018_after_26 <span class="ot">&lt;-</span> <span class="fu">subset</span>(team_data_2018_after_26,nameTeam <span class="sc">%in%</span> selected_teams_years_analysis) </span>
<span id="cb7-5"><a href="data-transformation.html#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="data-transformation.html#cb7-6" aria-hidden="true" tabindex="-1"></a>team_data_2017_after_26 <span class="ot">&lt;-</span> <span class="fu">teams_players_stats</span>(<span class="at">seasons =</span> <span class="dv">2017</span>, <span class="at">measures =</span> <span class="st">&quot;Advanced&quot;</span>, <span class="at">types =</span> <span class="st">&quot;team&quot;</span>, <span class="at">tables =</span> <span class="st">&quot;general&quot;</span>, <span class="at">modes =</span> <span class="st">&quot;PerGame&quot;</span>, <span class="at">date_from =</span> <span class="st">&quot;1-26-17&quot;</span>, <span class="at">date_to =</span> <span class="st">&quot;2-9-17&quot;</span>)<span class="sc">$</span>dataTable[[<span class="dv">1</span>]]</span>
<span id="cb7-7"><a href="data-transformation.html#cb7-7" aria-hidden="true" tabindex="-1"></a>selected_team_data_2017_after_26 <span class="ot">&lt;-</span> <span class="fu">subset</span>(team_data_2017_after_26,nameTeam <span class="sc">%in%</span> selected_teams_years_analysis) </span>
<span id="cb7-8"><a href="data-transformation.html#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="data-transformation.html#cb7-9" aria-hidden="true" tabindex="-1"></a>team_data_2016_after_26 <span class="ot">&lt;-</span> <span class="fu">teams_players_stats</span>(<span class="at">seasons =</span> <span class="dv">2016</span>, <span class="at">measures =</span> <span class="st">&quot;Advanced&quot;</span>, <span class="at">types =</span> <span class="st">&quot;team&quot;</span>, <span class="at">tables =</span> <span class="st">&quot;general&quot;</span>, <span class="at">modes =</span> <span class="st">&quot;PerGame&quot;</span>, <span class="at">date_from =</span> <span class="st">&quot;1-26-16&quot;</span>, <span class="at">date_to =</span> <span class="st">&quot;2-9-16&quot;</span>)<span class="sc">$</span>dataTable[[<span class="dv">1</span>]]</span>
<span id="cb7-10"><a href="data-transformation.html#cb7-10" aria-hidden="true" tabindex="-1"></a>selected_team_data_2016_after_26 <span class="ot">&lt;-</span> <span class="fu">subset</span>(team_data_2016_after_26,nameTeam <span class="sc">%in%</span> selected_teams_years_analysis) </span></code></pre></div>
<p>We then bound the row data for all the years together, and mutated the dataframe obtained with the corresponding year.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="data-transformation.html#cb8-1" aria-hidden="true" tabindex="-1"></a>consolidated_selected_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(selected_team_data_2020_after_26,selected_team_data_2019_after_26,selected_team_data_2018_after_26 ,selected_team_data_2017_after_26, selected_team_data_2016_after_26,selected_team_data_2021_after_26)</span>
<span id="cb8-2"><a href="data-transformation.html#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="data-transformation.html#cb8-3" aria-hidden="true" tabindex="-1"></a>date<span class="ot">&lt;-</span><span class="fu">as.POSIXct</span>(consolidated_selected_data<span class="sc">$</span>rangeDateTo,<span class="at">format =</span> <span class="st">&#39;%m-%d-%Y&#39;</span>)</span>
<span id="cb8-4"><a href="data-transformation.html#cb8-4" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(date,<span class="at">format =</span> <span class="st">&#39;%Y&#39;</span>))</span>
<span id="cb8-5"><a href="data-transformation.html#cb8-5" aria-hidden="true" tabindex="-1"></a>consolidated_selected_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(consolidated_selected_data,year)</span></code></pre></div>
<p>Lastly, we obtained a list of Kobe’s friends, and their gameplay statistics for the 2020 season and 2019 season (from 12th Jan to 16th February).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="data-transformation.html#cb9-1" aria-hidden="true" tabindex="-1"></a>kobe_bryant_friends <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Carmelo Anthony&#39;</span>,<span class="st">&#39;LeBron James&#39;</span>,<span class="st">&#39;Anthony Davis&#39;</span>,<span class="st">&#39;Trae Young&#39;</span>,<span class="st">&#39;Kevin Durant&#39;</span>,<span class="st">&#39;Stephen Curry&#39;</span>,<span class="st">&#39;Chris Paul&#39;</span>)</span>
<span id="cb9-2"><a href="data-transformation.html#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="data-transformation.html#cb9-3" aria-hidden="true" tabindex="-1"></a>team_data_2020_after_26 <span class="ot">&lt;-</span> <span class="fu">teams_players_stats</span>(<span class="at">seasons =</span> <span class="dv">2020</span>, <span class="at">measures =</span> <span class="st">&quot;Advanced&quot;</span>, <span class="at">types =</span> <span class="st">&quot;player&quot;</span>, <span class="at">tables =</span> <span class="st">&quot;general&quot;</span>, <span class="at">modes =</span> <span class="st">&quot;PerGame&quot;</span>, <span class="at">date_from =</span> <span class="st">&quot;1-26-20&quot;</span>, <span class="at">date_to =</span> <span class="st">&quot;2-16-20&quot;</span>)<span class="sc">$</span>dataTable[[<span class="dv">1</span>]]</span>
<span id="cb9-4"><a href="data-transformation.html#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="data-transformation.html#cb9-5" aria-hidden="true" tabindex="-1"></a>team_data_2020_before_26 <span class="ot">&lt;-</span> <span class="fu">teams_players_stats</span>(<span class="at">seasons =</span> <span class="dv">2020</span>, <span class="at">measures =</span> <span class="st">&quot;Advanced&quot;</span>, <span class="at">types =</span> <span class="st">&quot;player&quot;</span>, <span class="at">tables =</span> <span class="st">&quot;general&quot;</span>, <span class="at">modes =</span> <span class="st">&quot;PerGame&quot;</span>, <span class="at">date_from =</span> <span class="st">&quot;1-12-20&quot;</span>, <span class="at">date_to =</span> <span class="st">&quot;1-25-20&quot;</span>)<span class="sc">$</span>dataTable[[<span class="dv">1</span>]]</span>
<span id="cb9-6"><a href="data-transformation.html#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="data-transformation.html#cb9-7" aria-hidden="true" tabindex="-1"></a>team_data_2019_after_26 <span class="ot">&lt;-</span> <span class="fu">teams_players_stats</span>(<span class="at">seasons =</span> <span class="dv">2019</span>, <span class="at">measures =</span> <span class="st">&quot;Advanced&quot;</span>, <span class="at">types =</span> <span class="st">&quot;player&quot;</span>, <span class="at">tables =</span> <span class="st">&quot;general&quot;</span>, <span class="at">modes =</span> <span class="st">&quot;PerGame&quot;</span>, <span class="at">date_from =</span> <span class="st">&quot;1-26-19&quot;</span>, <span class="at">date_to =</span> <span class="st">&quot;2-16-19&quot;</span>)<span class="sc">$</span>dataTable[[<span class="dv">1</span>]]</span>
<span id="cb9-8"><a href="data-transformation.html#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="data-transformation.html#cb9-9" aria-hidden="true" tabindex="-1"></a>team_data_2019_before_26 <span class="ot">&lt;-</span> <span class="fu">teams_players_stats</span>(<span class="at">seasons =</span> <span class="dv">2019</span>, <span class="at">measures =</span> <span class="st">&quot;Advanced&quot;</span>, <span class="at">types =</span> <span class="st">&quot;player&quot;</span>, <span class="at">tables =</span> <span class="st">&quot;general&quot;</span>, <span class="at">modes =</span> <span class="st">&quot;PerGame&quot;</span>, <span class="at">date_from =</span> <span class="st">&quot;1-12-19&quot;</span>, <span class="at">date_to =</span> <span class="st">&quot;1-25-19&quot;</span>)<span class="sc">$</span>dataTable[[<span class="dv">1</span>]]</span></code></pre></div>
<p>We then cleaned the data obtained by a series of subsetting operations, and then by lengthening the data using a row bind().</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="data-transformation.html#cb10-1" aria-hidden="true" tabindex="-1"></a>selected_players_data_2020_after_26 <span class="ot">&lt;-</span> <span class="fu">subset</span>(team_data_2020_after_26,namePlayer <span class="sc">%in%</span> kobe_bryant_friends)</span>
<span id="cb10-2"><a href="data-transformation.html#cb10-2" aria-hidden="true" tabindex="-1"></a>selected_players_data_2020_before_26 <span class="ot">&lt;-</span> <span class="fu">subset</span>(team_data_2020_before_26,namePlayer <span class="sc">%in%</span> kobe_bryant_friends)</span>
<span id="cb10-3"><a href="data-transformation.html#cb10-3" aria-hidden="true" tabindex="-1"></a>selected_players_data_2019_after_26 <span class="ot">&lt;-</span> <span class="fu">subset</span>(team_data_2019_after_26,namePlayer <span class="sc">%in%</span> kobe_bryant_friends)</span>
<span id="cb10-4"><a href="data-transformation.html#cb10-4" aria-hidden="true" tabindex="-1"></a>selected_players_data_2019_before_26 <span class="ot">&lt;-</span> <span class="fu">subset</span>(team_data_2019_before_26,namePlayer <span class="sc">%in%</span> kobe_bryant_friends)</span>
<span id="cb10-5"><a href="data-transformation.html#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="data-transformation.html#cb10-6" aria-hidden="true" tabindex="-1"></a>consolidated_player_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(selected_players_data_2020_after_26,selected_players_data_2020_before_26,selected_players_data_2019_after_26,selected_players_data_2019_before_26)</span></code></pre></div>
</div>
<div id="injury-and-player-positions" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Injury and player positions</h2>
<p>The data for the entire analysis is retrieved by iterating and scraping through 1,291 pages of <a href="http://www.prosportstransactions.com/basketball" class="uri">http://www.prosportstransactions.com/basketball</a>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data-transformation.html#cb11-1" aria-hidden="true" tabindex="-1"></a>count <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1291</span>)</span>
<span id="cb11-2"><a href="data-transformation.html#cb11-2" aria-hidden="true" tabindex="-1"></a>pageNumbers <span class="ot">&lt;-</span> (count<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">25</span></span>
<span id="cb11-3"><a href="data-transformation.html#cb11-3" aria-hidden="true" tabindex="-1"></a>commonUrl <span class="ot">&lt;-</span> <span class="st">&#39;http://www.prosportstransactions.com/basketball/Search/SearchResults.php?Player=&amp;Team=&amp;BeginDate=&amp;EndDate=&amp;ILChkBx=yes&amp;Submit=Search&amp;start=&#39;</span></span>
<span id="cb11-4"><a href="data-transformation.html#cb11-4" aria-hidden="true" tabindex="-1"></a>allYearsdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Date=</span><span class="fu">character</span>(),<span class="at">Team=</span><span class="fu">character</span>(), <span class="at">Acquired=</span><span class="fu">character</span>(), <span class="at">Relinquished=</span><span class="fu">character</span>(), <span class="at">Notes=</span><span class="fu">character</span>()) </span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="data-transformation.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> pageNumbers)</span>
<span id="cb12-2"><a href="data-transformation.html#cb12-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb12-3"><a href="data-transformation.html#cb12-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">c</span>(commonUrl,i),<span class="at">collapse=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb12-4"><a href="data-transformation.html#cb12-4" aria-hidden="true" tabindex="-1"></a>page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url)</span>
<span id="cb12-5"><a href="data-transformation.html#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(url)</span>
<span id="cb12-6"><a href="data-transformation.html#cb12-6" aria-hidden="true" tabindex="-1"></a>content <span class="ot">&lt;-</span> page <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="data-transformation.html#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_node</span>(<span class="st">&#39;div.container&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-8"><a href="data-transformation.html#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_node</span>(<span class="st">&#39;table.datatable&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-9"><a href="data-transformation.html#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>()</span>
<span id="cb12-10"><a href="data-transformation.html#cb12-10" aria-hidden="true" tabindex="-1"></a>headings <span class="ot">&lt;-</span> <span class="fu">head</span>(content,<span class="dv">1</span>)</span>
<span id="cb12-11"><a href="data-transformation.html#cb12-11" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span>content</span>
<span id="cb12-12"><a href="data-transformation.html#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df) <span class="ot">&lt;-</span><span class="fu">c</span>(headings)</span>
<span id="cb12-13"><a href="data-transformation.html#cb12-13" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb12-14"><a href="data-transformation.html#cb12-14" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="st">&#39;•&#39;</span></span>
<span id="cb12-15"><a href="data-transformation.html#cb12-15" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Relinquished<span class="ot">&lt;-</span><span class="fu">sub</span>(x,<span class="st">&#39;&#39;</span>,df<span class="sc">$</span>Relinquished)</span>
<span id="cb12-16"><a href="data-transformation.html#cb12-16" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Acquired<span class="ot">&lt;-</span><span class="fu">sub</span>(x,<span class="st">&#39;&#39;</span>,df<span class="sc">$</span>Acquired)</span>
<span id="cb12-17"><a href="data-transformation.html#cb12-17" aria-hidden="true" tabindex="-1"></a>allYearsdf<span class="ot">&lt;-</span><span class="fu">rbind</span>(allYearsdf,df)</span>
<span id="cb12-18"><a href="data-transformation.html#cb12-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-19"><a href="data-transformation.html#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="data-transformation.html#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(allYearsdf,<span class="st">&#39;basketballScrapingOutput.csv&#39;</span>)</span></code></pre></div>
<p>The data we have scraped needs to be cleaned. All the players who are injured are generally placed in a list known as the relinquished list. We make sure that all the data we have scraped has player names and no blank values. Apart from that, it was observed that the player names scraped have a space before the words. Hence a trim operation was done to remove the space.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="data-transformation.html#cb13-1" aria-hidden="true" tabindex="-1"></a>newDf <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&#39;basketballScrapingOutput.csv&#39;</span>)</span>
<span id="cb13-2"><a href="data-transformation.html#cb13-2" aria-hidden="true" tabindex="-1"></a>newDf<span class="sc">$</span>Relinquished <span class="ot">&lt;-</span><span class="fu">str_trim</span>(newDf<span class="sc">$</span>Relinquished)</span>
<span id="cb13-3"><a href="data-transformation.html#cb13-3" aria-hidden="true" tabindex="-1"></a>newDf<span class="ot">&lt;-</span>newDf[<span class="sc">!</span>newDf<span class="sc">$</span>Relinquished <span class="sc">==</span> <span class="st">&#39;&#39;</span>,]</span>
<span id="cb13-4"><a href="data-transformation.html#cb13-4" aria-hidden="true" tabindex="-1"></a>newDf</span></code></pre></div>
<p>Post the retrieval, we merged the injury data we scraped with the player data from the NBA statistics package (nbaStatR). This was followed by data processing where we added the year in which the injury took place.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="data-transformation.html#cb14-1" aria-hidden="true" tabindex="-1"></a>playerData<span class="ot">&lt;-</span><span class="fu">dictionary_bref_players</span>()</span>
<span id="cb14-2"><a href="data-transformation.html#cb14-2" aria-hidden="true" tabindex="-1"></a>injuredPlayerData<span class="ot">&lt;-</span><span class="fu">merge</span>(newDf,playerData,<span class="at">by.x=</span><span class="st">&#39;Relinquished&#39;</span>,<span class="at">by.y=</span><span class="st">&#39;namePlayerBREF&#39;</span>)</span>
<span id="cb14-3"><a href="data-transformation.html#cb14-3" aria-hidden="true" tabindex="-1"></a>date<span class="ot">&lt;-</span><span class="fu">as.POSIXct</span>(injuredPlayerData<span class="sc">$</span>Date,<span class="at">format =</span> <span class="st">&#39;%Y-%m-%d&#39;</span>)</span>
<span id="cb14-4"><a href="data-transformation.html#cb14-4" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(date,<span class="at">format =</span> <span class="st">&#39;%Y&#39;</span>))</span>
<span id="cb14-5"><a href="data-transformation.html#cb14-5" aria-hidden="true" tabindex="-1"></a>injuredPlayerData<span class="ot">&lt;-</span><span class="fu">cbind</span>(injuredPlayerData,year)</span>
<span id="cb14-6"><a href="data-transformation.html#cb14-6" aria-hidden="true" tabindex="-1"></a>injuredPlayerData</span></code></pre></div>
<p>For our detailed analysis, we considered the last 8 years. Beyond this range, the analysis may prove to be futile, since basketball as a game evolves fairly quickly over time.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="data-transformation.html#cb15-1" aria-hidden="true" tabindex="-1"></a>yearsList <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(injuredPlayerData<span class="sc">$</span>year),<span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-2"><a href="data-transformation.html#cb15-2" aria-hidden="true" tabindex="-1"></a>yearsList <span class="ot">&lt;-</span> yearsList[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>]</span></code></pre></div>
<p>The player data we had contained URLs to the players profiles on basketball-reference.com/players. We scraped the position and hand (i.e Left Hand or Right Hand) from the URLs and merged it to the injury player data we have procured.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="data-transformation.html#cb16-1" aria-hidden="true" tabindex="-1"></a>topPlayerInjuryData <span class="ot">&lt;-</span><span class="fu">subset</span>(injuredPlayerData,year <span class="sc">%in%</span> yearsList )</span>
<span id="cb16-2"><a href="data-transformation.html#cb16-2" aria-hidden="true" tabindex="-1"></a>injuredPlayerUrls <span class="ot">&lt;-</span> topPlayerInjuryData[<span class="st">&#39;urlPlayerBioBREF&#39;</span>]</span>
<span id="cb16-3"><a href="data-transformation.html#cb16-3" aria-hidden="true" tabindex="-1"></a>positionalData<span class="ot">&lt;-</span><span class="fu">lapply</span>(injuredPlayerUrls[[<span class="dv">1</span>]], scrapPositionalData)</span>
<span id="cb16-4"><a href="data-transformation.html#cb16-4" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="fu">unlist</span>(positionalData), <span class="at">nrow=</span><span class="fu">length</span>(positionalData), <span class="at">byrow=</span><span class="cn">TRUE</span>))</span>
<span id="cb16-5"><a href="data-transformation.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&#39;position1&#39;</span>,<span class="st">&#39;hand&#39;</span>)</span></code></pre></div>
<p>The data at this point was holistic, with injury notes over 8 years. However, on visualizing the data, it was observed that the position field contained non-atomic entries (Since a player may have played at more than one position). Hence, we made sure the position field is atomic by separating the value onto two different rows.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="data-transformation.html#cb17-1" aria-hidden="true" tabindex="-1"></a>mergedPlayerInjuryData<span class="ot">&lt;-</span><span class="fu">cbind</span>(topPlayerInjuryData,df)</span>
<span id="cb17-2"><a href="data-transformation.html#cb17-2" aria-hidden="true" tabindex="-1"></a>mergedPlayerInjuryData <span class="ot">&lt;-</span> <span class="fu">separate_rows</span>(mergedPlayerInjuryData,position1,<span class="at">sep=</span><span class="st">&quot;and&quot;</span>)</span>
<span id="cb17-3"><a href="data-transformation.html#cb17-3" aria-hidden="true" tabindex="-1"></a>mergedPlayerInjuryData <span class="ot">&lt;-</span> <span class="fu">separate_rows</span>(mergedPlayerInjuryData,position1,<span class="at">sep=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb17-4"><a href="data-transformation.html#cb17-4" aria-hidden="true" tabindex="-1"></a>mergedPlayerInjuryData[<span class="sc">!</span>mergedPlayerInjuryData<span class="sc">$</span>position1 <span class="sc">==</span> <span class="st">&#39;&#39;</span>,]</span>
<span id="cb17-5"><a href="data-transformation.html#cb17-5" aria-hidden="true" tabindex="-1"></a>mergedPlayerInjuryData</span></code></pre></div>
<p>The injury notes do not give us a clear cut idea of injury the player had. Hence, we categorized the injuries of the players. The categories were obtained from the NBA injury types statistic.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="data-transformation.html#cb18-1" aria-hidden="true" tabindex="-1"></a>injuryDataNba <span class="ot">&lt;-</span> <span class="fu">bref_injuries</span>()</span>
<span id="cb18-2"><a href="data-transformation.html#cb18-2" aria-hidden="true" tabindex="-1"></a>injuryClasses <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">unique</span>(injuryDataNba<span class="sc">$</span>typeInjury))</span></code></pre></div>
<p>We created a function known as categoryDefine(), that took in the injury notes, and the injury
categories as input parameters, and returned back the most befitting category for a given entry. We then column bound this category to the injury dataset.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="data-transformation.html#cb19-1" aria-hidden="true" tabindex="-1"></a>notesList <span class="ot">&lt;-</span> preprocessedInjuryData<span class="sc">$</span>Notes</span>
<span id="cb19-2"><a href="data-transformation.html#cb19-2" aria-hidden="true" tabindex="-1"></a>injuryCategoryPlayers<span class="ot">&lt;-</span><span class="fu">lapply</span>(notesList, categoryDefine)</span>
<span id="cb19-3"><a href="data-transformation.html#cb19-3" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="fu">unlist</span>(injuryCategoryPlayers), <span class="at">nrow=</span><span class="fu">length</span>(injuryCategoryPlayers), <span class="at">byrow=</span><span class="cn">TRUE</span>))</span>
<span id="cb19-4"><a href="data-transformation.html#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&#39;typeInjury&#39;</span>)</span>
<span id="cb19-5"><a href="data-transformation.html#cb19-5" aria-hidden="true" tabindex="-1"></a>preprocessedInjuryData<span class="ot">&lt;-</span><span class="fu">cbind</span>(preprocessedInjuryData,df)</span></code></pre></div>
<p>The last step in the cleaning process was to get rid of the anomalous rows. We replaced the position Guard with Point Guard (since in a 2-2-1 zone formation a point guard is called a guard) and Forward with Small Forward (since in a 2-2-1 zone formation a point guard is called a forward). There were hardly any entries that were NA, but a few entries with ’’ in the column. We got rid of them by removing the rows with these values.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="data-transformation.html#cb20-1" aria-hidden="true" tabindex="-1"></a>preprocessedInjuryData<span class="sc">$</span>position1[preprocessedInjuryData<span class="sc">$</span>position1 <span class="sc">==</span> <span class="st">&#39;Guard&#39;</span>] <span class="ot">&lt;-</span> <span class="st">&#39;PointGuard&#39;</span></span>
<span id="cb20-2"><a href="data-transformation.html#cb20-2" aria-hidden="true" tabindex="-1"></a>preprocessedInjuryData<span class="sc">$</span>position1[preprocessedInjuryData<span class="sc">$</span>position1 <span class="sc">==</span> <span class="st">&#39;Forward&#39;</span>] <span class="ot">&lt;-</span> <span class="st">&#39;SmallForward&#39;</span></span>
<span id="cb20-3"><a href="data-transformation.html#cb20-3" aria-hidden="true" tabindex="-1"></a>preprocessedInjuryData<span class="ot">&lt;-</span>preprocessedInjuryData[<span class="sc">!</span>preprocessedInjuryData<span class="sc">$</span>Relinquished <span class="sc">==</span> <span class="st">&#39;&#39;</span>,]</span>
<span id="cb20-4"><a href="data-transformation.html#cb20-4" aria-hidden="true" tabindex="-1"></a>preprocessedInjuryData<span class="ot">&lt;-</span>preprocessedInjuryData[<span class="sc">!</span>preprocessedInjuryData<span class="sc">$</span>position1 <span class="sc">==</span> <span class="st">&#39;&#39;</span>,]</span></code></pre></div>
</div>
<div id="d3" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> d3</h2>
<p>A small amount of tooling was required to use the NBAstatR data with d3. To make the amount of players more manageable, we
pared down the total number of players in the dataset to just the big names on each team. There
are a number of players that play only a few games each year and greatly skew their ranking data. So,
get the best and most notable players, we needed to look beyond ratings. First, took data from the whole season for only <em>starters</em>.
This already eliminates a lot of players – only reasonably good players get to start.
Then, we took the top 6 ranks for each team by number of games started.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="data-transformation.html#cb21-1" aria-hidden="true" tabindex="-1"></a>starters <span class="ot">&lt;-</span> <span class="fu">teams_players_stats</span>(<span class="at">seasons =</span> <span class="dv">2020</span>, <span class="at">types =</span> <span class="st">&quot;player&quot;</span>, <span class="at">starters_bench =</span> <span class="fu">list</span>(<span class="st">&quot;Starters&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="data-transformation.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(dataTable) </span>
<span id="cb21-3"><a href="data-transformation.html#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="data-transformation.html#cb21-4" aria-hidden="true" tabindex="-1"></a>top_guys_bubble <span class="ot">&lt;-</span> starters <span class="sc">%&gt;%</span> </span>
<span id="cb21-5"><a href="data-transformation.html#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(bubble_seeding_players, <span class="at">by =</span> <span class="st">&quot;namePlayer&quot;</span>) <span class="sc">%&gt;%</span> <span class="co">#only return players with bubble data, some players opted out</span></span>
<span id="cb21-6"><a href="data-transformation.html#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(covid_season_players_month_before, <span class="at">by =</span> <span class="st">&quot;namePlayer&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-7"><a href="data-transformation.html#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(slugTeam) <span class="sc">%&gt;%</span> </span>
<span id="cb21-8"><a href="data-transformation.html#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(gp, <span class="at">n =</span> <span class="dv">6</span>)</span></code></pre></div>
<p>Once we found the list of players we wanted, we filtered our game data from these names.
Then, we cut down the amount of game stats to just the ones we were interested in.
Finally, we spread the data wide by time period so that data from each period would be associated with a
single svg element. This would allow us to access this data easily, letting us read the data just once.</p>
<p>Being d3 beginners, we were not sure of this approach. Maybe performance would have been better to
add/remove dots as needed rather than load them all and hide/show them? Or even split the csv into three,
one for each time period, loading as needed. Regardless, this approach worked!</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="data-transformation.html#cb22-1" aria-hidden="true" tabindex="-1"></a>d3_data <span class="ot">&lt;-</span> bubble_season_combined <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="data-transformation.html#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(top_guys_bubble, <span class="at">by =</span> <span class="st">&quot;namePlayer&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="data-transformation.html#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(bubble_teams, <span class="at">by =</span> <span class="st">&quot;slugTeam&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="data-transformation.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">name =</span> <span class="st">&quot;namePlayer&quot;</span>,</span>
<span id="cb22-5"><a href="data-transformation.html#cb22-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">team_abb =</span> <span class="st">&quot;slugTeam&quot;</span>,</span>
<span id="cb22-6"><a href="data-transformation.html#cb22-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">team_name =</span> <span class="st">&quot;nameTeam&quot;</span>,</span>
<span id="cb22-7"><a href="data-transformation.html#cb22-7" aria-hidden="true" tabindex="-1"></a>         ortg,</span>
<span id="cb22-8"><a href="data-transformation.html#cb22-8" aria-hidden="true" tabindex="-1"></a>         drtg,</span>
<span id="cb22-9"><a href="data-transformation.html#cb22-9" aria-hidden="true" tabindex="-1"></a>         netrtg,</span>
<span id="cb22-10"><a href="data-transformation.html#cb22-10" aria-hidden="true" tabindex="-1"></a>         df_type</span>
<span id="cb22-11"><a href="data-transformation.html#cb22-11" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb22-12"><a href="data-transformation.html#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;df_type&quot;</span>, <span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">&quot;ortg&quot;</span>, <span class="st">&quot;drtg&quot;</span>, <span class="st">&quot;netrtg&quot;</span>))</span>
<span id="cb22-13"><a href="data-transformation.html#cb22-13" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb22-14"><a href="data-transformation.html#cb22-14" aria-hidden="true" tabindex="-1"></a>d3_data <span class="sc">%&gt;%</span></span>
<span id="cb22-15"><a href="data-transformation.html#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&quot;data/d3_data.csv&quot;</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-sources.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="missing-values.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/hernandz/nba_edav_2021/edit/main/03-cleaning.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/hernandz/nba_edav_2021/blob/main/03-cleaning.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
